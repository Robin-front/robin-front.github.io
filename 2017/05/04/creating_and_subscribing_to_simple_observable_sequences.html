<!DOCTYPE html><html class="theme-next muse use-motion" lang="zh-Hans"><head>
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">



  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2" rel="stylesheet">







<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">



  <meta name="google-site-verification" content="ezF4b6TIq3nrF8BJmQrK_v9BmJnUQfVVPB4xBYo7AD8">








  <meta name="baidu-site-verification" content="T2V9h2EnoE">







  
  
    
  
  <link href="https://cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.css" rel="stylesheet" type="text/css">



  
  
    
  
  <link href="https://unpkg.com/gitalk/dist/gitalk.css" rel="stylesheet" type="text/css">







  

<link href="https://cdn.staticfile.org/font-awesome/4.6.2/css/font-awesome.min.css" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/touch-icon.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-16.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-32.png?v=5.1.4">


  <link rel="mask-icon" href="/touch-icon.png?v=5.1.4" color="#222">





  <meta name="keywords" content="RxJS,">





  <link rel="alternate" href="/atom.xml" title="知更鸟" type="application/atom+xml">






<meta name="description" content="来自 创建和订阅单一可观察序列你不需要去实现 Observable 类去创建一个可观察序列。 同样的，你也不需要去实现 Observer 去订阅数据流。通过安装 Rx 库，你可以利用 Observable类型，它提供了许多操作符来根据零个，一个或多个元素去创建一个数据流。另外， RxJS 还提供 subscribe 方法允许你使用 onNext, onError 和 onCompleted 函数。">
<meta name="keywords" content="RxJS">
<meta property="og:type" content="article">
<meta property="og:title" content="使用RxJS创建和订阅单一数据流">
<meta property="og:url" content="http://robin-front.github.io/2017/05/04/creating_and_subscribing_to_simple_observable_sequences.html">
<meta property="og:site_name" content="知更鸟">
<meta property="og:description" content="来自 创建和订阅单一可观察序列你不需要去实现 Observable 类去创建一个可观察序列。 同样的，你也不需要去实现 Observer 去订阅数据流。通过安装 Rx 库，你可以利用 Observable类型，它提供了许多操作符来根据零个，一个或多个元素去创建一个数据流。另外， RxJS 还提供 subscribe 方法允许你使用 onNext, onError 和 onCompleted 函数。">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2017-05-04T18:06:14.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="使用RxJS创建和订阅单一数据流">
<meta name="twitter:description" content="来自 创建和订阅单一可观察序列你不需要去实现 Observable 类去创建一个可观察序列。 同样的，你也不需要去实现 Observer 去订阅数据流。通过安装 Rx 库，你可以利用 Observable类型，它提供了许多操作符来根据零个，一个或多个元素去创建一个数据流。另外， RxJS 还提供 subscribe 方法允许你使用 onNext, onError 和 onCompleted 函数。">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://robin-front.github.io/2017/05/04/creating_and_subscribing_to_simple_observable_sequences.html">





  <title>使用RxJS创建和订阅单一数据流 | 知更鸟</title>
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
  (adsbygoogle = window.adsbygoogle || []).push({
    google_ad_client: "ca-pub-8386186071288063",
    enable_page_level_ads: true
  });
  </script>
  




<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-74634898-1', 'auto');
  ga('send', 'pageview');
</script>


  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?51f2c21567935649debac704a10c43f1";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




<link rel="stylesheet" href="/css/prism.css" type="text/css"></head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">知更鸟</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <h1 class="site-subtitle" itemprop="description">robin</h1>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-travel">
          <a href="/tags/travel/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-plane"></i> <br>
            
            旅行
          </a>
        </li>
      
        
        <li class="menu-item menu-item-commonweal">
          <a href="/404/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-heartbeat"></i> <br>
            
            公益404
          </a>
        </li>
      
        
        <li class="menu-item menu-item-sitemap">
          <a href="/sitemap.xml" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-sitemap"></i> <br>
            
            站点地图
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://robin-front.github.io/2017/05/04/creating_and_subscribing_to_simple_observable_sequences.html">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="robin.law">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars2.githubusercontent.com/u/6723674?v=3&s=460">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="知更鸟">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">使用RxJS创建和订阅单一数据流</h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-05-04T18:06:14+00:00">
                2017-05-04
              </time>
            

            
              <span class="post-meta-divider">|</span>
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-check-o"></i>
              </span>
              
                <span class="post-meta-item-text">更新于:</span>
              
              <time title="更新于" itemprop="dateModified" datetime="2017-05-04T18:06:14+00:00">
                2017-05-04
              </time>
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/javascript/" itemprop="url" rel="index">
                    <span itemprop="name">javascript</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          
            <span class="post-meta-divider">|</span>
            <span class="page-pv"><i class="fa fa-file-o"></i>
            <span class="busuanzi-value" id="busuanzi_value_page_pv"></span>
            </span>
          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计:</span>
                
                <span title="字数统计">
                  2,967
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 ≈</span>
                
                <span title="阅读时长">
                  12
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p><a href="https://robin-front.gitbooks.io/rxjs-doc-chinese/content/content/getting_started_with_rxjs/creating_and_querying_observable_sequences/creating_and_subscribing_to_simple_observable_sequences.html" target="_blank" rel="noopener">来自</a></p>
<h1 id="创建和订阅单一可观察序列"><a href="#创建和订阅单一可观察序列" class="headerlink" title="创建和订阅单一可观察序列"></a>创建和订阅单一可观察序列</h1><p>你不需要去实现 <code>Observable</code> 类去创建一个可观察序列。 同样的，你也不需要去实现 <code>Observer</code> 去订阅数据流。通过安装 Rx 库，你可以利用 <code>Observable</code>类型，它提供了许多操作符来根据零个，一个或多个元素去创建一个数据流。另外， RxJS 还提供 <code>subscribe</code> 方法允许你使用 <code>onNext</code>, <code>onError</code> 和 <code>onCompleted</code> 函数。</p>
<a id="more"></a>
<h2 id="从零创建一个数据流"><a href="#从零创建一个数据流" class="headerlink" title="从零创建一个数据流"></a>从零创建一个数据流</h2><p>在使用操作符之前，让我们看一看怎样使用 <a href="https://github.com/Reactive-Extensions/RxJS/tree/master/doc/api/core/operators/create.md" target="_blank" rel="noopener"><code>Rx.Observable.create</code></a> 方法从零创建 <code>Observable</code> 。</p>
<p>首先， 我们需要确认引用了 <code>rx.js</code> 核心文件。</p>
<pre class=" language-html"><script src="rx.js"><code class="language-html"><script src="rx.js"></script>
</pre>
<p>如果我们使用 <a href="http://node.js" target="_blank" rel="noopener">Node.js</a>， 我们可以这样引入:</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> Rx <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'rx'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>在这个例子中， 我们将只产生一个单一值42，然后标记为完成。 如果不需要清除，返回值是完全可选的。</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> source <span class="token operator">=</span> Rx<span class="token punctuation">.</span>Observable<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>observer <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token comment" spellcheck="true">// 产生一个单一值然后完成。</span>
  observer<span class="token punctuation">.</span><span class="token function">onNext</span><span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  observer<span class="token punctuation">.</span><span class="token function">onCompleted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment" spellcheck="true">// 任何清除的逻辑写在这里</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'disposed'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> subscription <span class="token operator">=</span> source<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>
  x <span class="token operator">=</span><span class="token operator">></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'onNext: %s'</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">,</span>
  e <span class="token operator">=</span><span class="token operator">></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'onError: %s'</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'onCompleted'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// => onNext: 42</span>
<span class="token comment" spellcheck="true">// => onCompleted</span>

subscription<span class="token punctuation">.</span><span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">// => disposed</span>
</code></pre>
<p>对于大多数操作， 这完全是多余的，但这展示了非常基础的大部分 RxJS 操作符是如何工作的。</p>
<h2 id="创建及订阅单一数据流"><a href="#创建及订阅单一数据流" class="headerlink" title="创建及订阅单一数据流"></a>创建及订阅单一数据流</h2><p>接下来的例子使用 <code>Observable</code> 类的 <a href="https://github.com/Reactive-Extensions/RxJS/tree/master/doc/api/core/operators/range.md" target="_blank" rel="noopener"><code>range</code></a> 操作符来创建一个包含一些数字的单一数据流。观察者使用 <code>Observable</code> 类的 <code>Subscribe</code> 订阅这个数据流集合， 并且处理回调 <code>onNext</code>, <code>onError</code> and <code>onCompleted</code>。在我们的例子中，创建了一个从 x 开始的整数序列，然后接下来产生 y 个。</p>
<p>只要订阅了数据流，数据就会发送给观察者。<code>onNext</code>函数会打印出这个值。</p>
<pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// 创建一个从 1 开始，包含 5 个整数的数据流</span>
<span class="token keyword">var</span> source <span class="token operator">=</span> Rx<span class="token punctuation">.</span>Observable<span class="token punctuation">.</span><span class="token function">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// 打印每个值</span>
<span class="token keyword">var</span> subscription <span class="token operator">=</span> source<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>
  x <span class="token operator">=</span><span class="token operator">></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'onNext: %s'</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">,</span>
  e <span class="token operator">=</span><span class="token operator">></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'onError: %s'</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'onCompleted'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// => onNext: 1</span>
<span class="token comment" spellcheck="true">// => onNext: 2</span>
<span class="token comment" spellcheck="true">// => onNext: 3</span>
<span class="token comment" spellcheck="true">// => onNext: 4</span>
<span class="token comment" spellcheck="true">// => onNext: 5</span>
<span class="token comment" spellcheck="true">// => onCompleted</span>
</code></pre>
<p>当一个观察者订阅了一个数据流， <code>subscribe</code> 方法背后使用的异步操作取决于操作符。因些， <code>subscribe</code> 的调用是异步的，因为调用者在完成序列观察之前不会被阻塞。这篇文章 <a href="schedulers.md">Using Schedulers</a> 提供了更多信息。</p>
<p>注意 <a href="https://github.com/Reactive-Extensions/RxJS/tree/master/doc/api/core/operators/susbcribe.md" target="_blank" rel="noopener"><code>subscribe</code></a> 方法返回一个 <code>Disposable</code>，所以你可以很容易地退订和销毁它。当你在可观察对象上调用 <code>dispose</code> 方法时，观察者将会停止监听数据流。正常来说，你不需要精确地调用 <code>dispose</code> 除非你需要提前退订，或者当数据流的生命周期比观察者的还长。 Rx 的订阅被设计成 <code>触发-丢弃</code> 的场景，并不需要终结者。注意到，可观察对象的操作符的默认表现是 只要有可能（比如，<code>onCompleted</code> 或 <code>onError</code> 消息被发送时），订阅就会被销毁。举个例子，下面的代码将会订阅 a 和 b 两个数据流。如果 a 抛出一个错误， x 会立即退订 b 。</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> x <span class="token operator">=</span> Rx<span class="token punctuation">.</span>Observable<span class="token punctuation">.</span><span class="token function">zip</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> <span class="token punctuation">(</span>a1<span class="token punctuation">,</span> b1<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> a1 <span class="token operator">+</span> b1<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>还可以调整代码示例以使用观察者的 <code>Create</code> 运算符，创建并从指定的 <code>OnNext</code>, <code>OnError</code>, 和 <code>OnCompleted</code> 回调返回一个观察者。然后你可以传递 <code>observer</code> 给 <code>observable</code> 的 <code>subscribe</code> 方法。下面的例子展示了这种写法。</p>
<pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// 创建包含 5个整数的数据流，从 1 开始</span>
<span class="token keyword">var</span> source <span class="token operator">=</span> Rx<span class="token punctuation">.</span>Observable<span class="token punctuation">.</span><span class="token function">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// 创建观察者</span>
<span class="token keyword">var</span> observer <span class="token operator">=</span> Rx<span class="token punctuation">.</span>Observer<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>
  x <span class="token operator">=</span><span class="token operator">></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'onNext: %s'</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">,</span>
  e <span class="token operator">=</span><span class="token operator">></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'onError: %s'</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'onCompleted'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// 打印每个结果</span>
<span class="token keyword">var</span> subscription <span class="token operator">=</span> source<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>observer<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// => onNext: 1</span>
<span class="token comment" spellcheck="true">// => onNext: 2</span>
<span class="token comment" spellcheck="true">// => onNext: 3</span>
<span class="token comment" spellcheck="true">// => onNext: 4</span>
<span class="token comment" spellcheck="true">// => onNext: 5</span>
<span class="token comment" spellcheck="true">// => onCompleted</span>
</code></pre>
<p>另外，从零创建一个数据流，你也可以将已存在的 数据， 事件，回调以及 <code>promise</code> 转换成数据流。下一节的主题将会教你怎么做。</p>
<p>注意，这一节只展示了可以从零创建数据流的很少一部分操作符。学习更多其他的  <code>LINQ</code> 操作符， 可以查看 <a href="querying_observable_squences.md">Querying Observable Sequences</a>.</p>
<h2 id="使用定时器"><a href="#使用定时器" class="headerlink" title="使用定时器"></a>使用定时器</h2><p>接下来的例子使用 <a href="https://github.com/Reactive-Extensions/RxJS/tree/master/doc/api/core/operators/timer.md" target="_blank" rel="noopener"><code>timer</code></a> 操作符去创建一个数据流。 这个数据流将在5秒后输出第一个值，接着每1秒输出后面的值。为了说明， 我们配合 <a href="https://github.com/Reactive-Extensions/RxJS/tree/master/doc/api/core/operators/timestamp.md" target="_blank" rel="noopener"><code>timestamp</code></a> 操作符去查询，使每一个被推出来的值将在发布时追加时间戳。这样，当我们订阅这个数据源时，我们可以接收到值和时间戳。</p>
<p>首先，我们需要确认我们是否在浏览器引入了相关的文件。注意 RxJS NPM 包已经默认包含了所有操作符。</p>
<pre class=" language-html"><script src="rx.js"><code class="language-html"><script src="rx.js"></script>
<script src="rx.time.js"></script>
</pre>
<p>下面是我们的例子：</p>
<pre class=" language-js"><code class="language-js">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Current time: '</span> <span class="token operator">+</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> source <span class="token operator">=</span> Rx<span class="token punctuation">.</span>Observable<span class="token punctuation">.</span><span class="token function">timer</span><span class="token punctuation">(</span>
  <span class="token number">5000</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">/* 5 秒 */</span>
  <span class="token number">1000</span> <span class="token comment" spellcheck="true">/* 1 秒 */</span><span class="token punctuation">)</span>
   <span class="token punctuation">.</span><span class="token function">timestamp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> subscription <span class="token operator">=</span> source<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>
  x <span class="token operator">=</span><span class="token operator">></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span>value <span class="token operator">+</span> <span class="token string">': '</span> <span class="token operator">+</span> x<span class="token punctuation">.</span>timestamp<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">/* 输出可能像这样子 */</span>
<span class="token comment" spellcheck="true">// Current time: 1382560697820</span>
<span class="token comment" spellcheck="true">// 0: 1382560702820</span>
<span class="token comment" spellcheck="true">// 1: 1382560703820</span>
<span class="token comment" spellcheck="true">// 2: 1382560704820</span>
</code></pre>
<p>通过使用 <code>timestamp</code> 操作符，我们可以证实，第一个值确实是开始5秒后输出，然后每1秒输出一个值。</p>
<h2 id="将数组和可迭代对象转换为数据流"><a href="#将数组和可迭代对象转换为数据流" class="headerlink" title="将数组和可迭代对象转换为数据流"></a>将数组和可迭代对象转换为数据流</h2><p>使用 <a href="https://github.com/Reactive-Extensions/RxJS/tree/master/doc/api/core/operators/from.md" target="_blank" rel="noopener"><code>Rx.Observable.from</code></a> 操作符，你可以将一个数组转换为数据流。</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> array <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// 将数组转换为数据流</span>
<span class="token keyword">var</span> source <span class="token operator">=</span> Rx<span class="token punctuation">.</span>Observable<span class="token punctuation">.</span><span class="token keyword">from</span><span class="token punctuation">(</span>array<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// 输出每个值</span>
<span class="token keyword">var</span> subscription <span class="token operator">=</span> source<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>
  x <span class="token operator">=</span><span class="token operator">></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'onNext: %s'</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">,</span>
  e <span class="token operator">=</span><span class="token operator">></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'onError: %s'</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'onCompleted'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// => onNext: 1</span>
<span class="token comment" spellcheck="true">// => onNext: 2</span>
<span class="token comment" spellcheck="true">// => onNext: 3</span>
<span class="token comment" spellcheck="true">// => onNext: 4</span>
<span class="token comment" spellcheck="true">// => onNext: 5</span>
<span class="token comment" spellcheck="true">// => onCompleted</span>
</code></pre>
<p>你也可以转换类数组结构，比如包含 <code>length</code> 属性和数字索引的对象。这种情况下，我们只简单有一个包含长度为5的对象。</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> arrayLike <span class="token operator">=</span> <span class="token punctuation">{</span> length<span class="token punctuation">:</span> <span class="token number">5</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// 转换数组为数据流</span>
<span class="token keyword">var</span> source <span class="token operator">=</span> Rx<span class="token punctuation">.</span>Observable<span class="token punctuation">.</span><span class="token keyword">from</span><span class="token punctuation">(</span>arrayLike<span class="token punctuation">,</span> <span class="token punctuation">(</span>v<span class="token punctuation">,</span> k<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> k<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// 输出每个值</span>
<span class="token keyword">var</span> subscription <span class="token operator">=</span> source<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>
  x <span class="token operator">=</span><span class="token operator">></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'onNext: %s'</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">,</span>
  e <span class="token operator">=</span><span class="token operator">></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'onError: %s'</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'onCompleted'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// => onNext: 1</span>
<span class="token comment" spellcheck="true">// => onNext: 2</span>
<span class="token comment" spellcheck="true">// => onNext: 3</span>
<span class="token comment" spellcheck="true">// => onNext: 4</span>
<span class="token comment" spellcheck="true">// => onNext: 5</span>
<span class="token comment" spellcheck="true">// => onCompleted</span>

</code></pre>
<p>另外，我们也可以使用 ES6 可迭代对象，如 <code>Map</code> 和 <code>Set</code> 使用 <code>from</code> 转换成数据流。下面这个例子，我们将获取一个 <code>Set</code> 对象，并且将它转换成数据流。</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> <span class="token keyword">set</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// 转换 Set 为数据流</span>
<span class="token keyword">var</span> source <span class="token operator">=</span> Rx<span class="token punctuation">.</span>Observable<span class="token punctuation">.</span><span class="token keyword">from</span><span class="token punctuation">(</span><span class="token keyword">set</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// 转出每个值</span>
<span class="token keyword">var</span> subscription <span class="token operator">=</span> source<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>
  x <span class="token operator">=</span><span class="token operator">></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'onNext: %s'</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">,</span>
  e <span class="token operator">=</span><span class="token operator">></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'onError: %s'</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'onCompleted'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// => onNext: 1</span>
<span class="token comment" spellcheck="true">// => onNext: 2</span>
<span class="token comment" spellcheck="true">// => onNext: 3</span>
<span class="token comment" spellcheck="true">// => onNext: 4</span>
<span class="token comment" spellcheck="true">// => onNext: 5</span>
<span class="token comment" spellcheck="true">// => onCompleted</span>
</code></pre>
<p>我们也可以将它应用在 <code>Map</code> 对象上面。</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'key1'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'key2'</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// 将 Map 转换成数据流</span>
<span class="token keyword">var</span> source <span class="token operator">=</span> Rx<span class="token punctuation">.</span>Observable<span class="token punctuation">.</span><span class="token keyword">from</span><span class="token punctuation">(</span>map<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// 打印每个值</span>
<span class="token keyword">var</span> subscription <span class="token operator">=</span> source<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>
  x <span class="token operator">=</span><span class="token operator">></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'onNext: %s'</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">,</span>
  e <span class="token operator">=</span><span class="token operator">></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'onError: %s'</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'onCompleted'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// => onNext: key1, 1</span>
<span class="token comment" spellcheck="true">// => onNext: key2, 2</span>
<span class="token comment" spellcheck="true">// => onCompleted</span>
</code></pre>
<p><code>from</code> 方法也支持 ES6 generators，可以你的浏览器已经支持，或将要支持。这允许我们实现一些像 <code>斐波那契序列</code> 等，并将它们转换成数据流。</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">function</span><span class="token operator">*</span> fibonacci <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> fn1 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> fn2 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">var</span> current <span class="token operator">=</span> fn2<span class="token punctuation">;</span>
    fn2 <span class="token operator">=</span> fn1<span class="token punctuation">;</span>
    fn1 <span class="token operator">=</span> fn1 <span class="token operator">+</span> current<span class="token punctuation">;</span>
    <span class="token keyword">yield</span> current<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">// 将 generator 转换成数据流</span>
<span class="token keyword">var</span> source <span class="token operator">=</span> Rx<span class="token punctuation">.</span>Observable<span class="token punctuation">.</span><span class="token keyword">from</span><span class="token punctuation">(</span><span class="token function">fibonacci</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">take</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// 打印每个值</span>
<span class="token keyword">var</span> subscription <span class="token operator">=</span> source<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>
  x <span class="token operator">=</span><span class="token operator">></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'onNext: %s'</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">,</span>
  e <span class="token operator">=</span><span class="token operator">></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'onError: %s'</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'onCompleted'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// => onNext: 1</span>
<span class="token comment" spellcheck="true">// => onNext: 1</span>
<span class="token comment" spellcheck="true">// => onNext: 2</span>
<span class="token comment" spellcheck="true">// => onNext: 3</span>
<span class="token comment" spellcheck="true">// => onNext: 5</span>
<span class="token comment" spellcheck="true">// => onCompleted</span>
</code></pre>
<h2 id="冷（惰性）-vs-热（非惰性）-数据流"><a href="#冷（惰性）-vs-热（非惰性）-数据流" class="headerlink" title="冷（惰性） vs. 热（非惰性） 数据流"></a>冷（惰性） vs. 热（非惰性） 数据流</h2><p>冷数据流的开始运行取决于订阅，比如，数据流只有当 <code>subscribe</code> 调用的时候才开始输出值。用户之间也没有共享值。这些是与热数据流的不同之处，热数据像流鼠标移动事件或股票代码这样的订阅时就已经不断输出值。当观察者订阅热数据流时，它将会获取流的实时值。热数据流是与所有订阅者共享的，每个订阅者按顺序推送下一个值。举个例子，就算没有人订阅一个特定的股票，股票市场也将继续根据市场动向更新其价值。当有注册者对这支股票感兴趣时，它会自动获得股票的最新值。</p>
<p>下面的示例演示了一个冷数据流。这个例子中，我们使用了 <code>Interval</code> 操作符去创建一个单一数据流并在特定的时间间隔输出值，这个例子中是间隔1秒。</p>
<p>两个观察者订阅这个数据流并打印输出值。你会注意到数据流会为每个订阅者重置，第二个订阅者也是从第1个值开始的。</p>
<p>首先，我们需要确保在浏览器中引入了相关文件。注意 RxJS NPM 包已经默认包含了所有操作符。</p>
<pre class=" language-html"><script src="rx.lite.js"><code class="language-html"><script src="rx.lite.js"></script>
</pre>
<p>然后是例子：</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> source <span class="token operator">=</span> Rx<span class="token punctuation">.</span>Observable<span class="token punctuation">.</span><span class="token function">interval</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> subscription1 <span class="token operator">=</span> source<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>
  x <span class="token operator">=</span><span class="token operator">></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Observer 1: onNext: '</span> <span class="token operator">+</span> x<span class="token punctuation">)</span><span class="token punctuation">,</span>
  e <span class="token operator">=</span><span class="token operator">></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Observer 1: onError: '</span> <span class="token operator">+</span> e<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Observer 1: onCompleted'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> subscription2 <span class="token operator">=</span> source<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>
  x <span class="token operator">=</span><span class="token operator">></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Observer 2: onNext: '</span> <span class="token operator">+</span> x<span class="token punctuation">)</span><span class="token punctuation">,</span>
  e <span class="token operator">=</span><span class="token operator">></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Observer 2: onError: '</span> <span class="token operator">+</span> e<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Observer 2: onCompleted'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
  subscription1<span class="token punctuation">.</span><span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  subscription2<span class="token punctuation">.</span><span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// => Observer 1: onNext: 0</span>
<span class="token comment" spellcheck="true">// => Observer 2: onNext: 0</span>
<span class="token comment" spellcheck="true">// => Observer 1: onNext: 1</span>
<span class="token comment" spellcheck="true">// => Observer 2: onNext: 1</span>
<span class="token comment" spellcheck="true">// => Observer 1: onNext: 2</span>
<span class="token comment" spellcheck="true">// => Observer 2: onNext: 2</span>
<span class="token comment" spellcheck="true">// => Observer 1: onNext: 3</span>
<span class="token comment" spellcheck="true">// => Observer 2: onNext: 3</span>
</code></pre>
<p>接下来的例子中，我们使用 <a href="https://github.com/Reactive-Extensions/RxJS/tree/master/doc/api/core/operators/publish.md" target="_blank" rel="noopener"><code>publish</code></a> 操作符将前面的冷数据源转换成热数据源，返回一个 <code>ConnectableObservable</code> 实例，我们称为 <code>hot</code>。<a href="https://github.com/Reactive-Extensions/RxJS/tree/master/doc/api/core/operators/publish.md" target="_blank" rel="noopener"><code>publish</code></a> 操作符通过向多个订阅服务器广播单个订阅来提供共享订阅的机制。<code>hot</code>变量作为代理订阅 <code>source</code>，因为它从 <code>source</code> 接收值，推到自己的用户. 我们使用 <a href="https://github.com/Reactive-Extensions/RxJS/tree/master/doc/api/core/operators/connect.md" target="_blank" rel="noopener"><code>ConnectableObservable.prototype.connect</code></a> 建立订阅的备份源，并开始接收值。因为 <code>ConnectableObservable</code> 继承自 <code>Observable</code>， 我们可以在它运行之前使用 <code>subscribe</code> 去订阅这个热数据流。 在这个例子中要注意，当 <code>subscription1</code>订阅它的时候热数据流还没有开始。因些，没有值输出给订阅者。只有调用 <code>Connect</code> 之后，输出值才会推送给 <code>subscription1</code>。3秒的延迟之后，<code>subscription2</code> 订阅了热数据流，并且立即开始接收当前输出值（当前值是3），一直到最后。输出结果看起来像这样：</p>
<pre><code>// => Current time: 1382562433256
// => Current Time after 1st subscription: 1382562433260
// => Current Time after connect: 1382562436261
// => Observer 1: onNext: 0
// => Observer 1: onNext: 1
// => Current Time after 2nd subscription: 1382562439262
// => Observer 1: onNext: 2
// => Observer 2: onNext: 2
// => Observer 1: onNext: 3
// => Observer 2: onNext: 3
// => Observer 1: onNext: 4
// => Observer 2: onNext: 4
</code></pre><p>首先，我们需要确认我们引入了相关文件。注意 RxJS NPM包已经默认包含了所有操作符。</p>
<pre class=" language-html"><script src="rx.lite.js"><code class="language-html"><script src="rx.lite.js"></script>
</pre>
<p>接下来是例子！</p>
<pre class=" language-js"><code class="language-js">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Current time: '</span> <span class="token operator">+</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// 创建一个数据流</span>
<span class="token keyword">var</span> source <span class="token operator">=</span> Rx<span class="token punctuation">.</span>Observable<span class="token punctuation">.</span><span class="token function">interval</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// 将数据流转换成热数据流</span>
<span class="token keyword">var</span> hot <span class="token operator">=</span> source<span class="token punctuation">.</span><span class="token function">publish</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// 第一个订阅时没有值输出</span>
<span class="token keyword">var</span> subscription1 <span class="token operator">=</span> hot<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>
  x <span class="token operator">=</span><span class="token operator">></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Observer 1: onNext: %s'</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">,</span>
  e <span class="token operator">=</span><span class="token operator">></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Observer 1: onError: %s'</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Observer 1: onCompleted'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Current Time after 1st subscription: '</span> <span class="token operator">+</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// 空闲 3 秒</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>

  <span class="token comment" spellcheck="true">// 热数据源连接并开始输出值给订阅者</span>
  hot<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Current Time after connect: '</span> <span class="token operator">+</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment" spellcheck="true">// 又空闲 3 秒</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>

    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Current Time after 2nd subscription: '</span> <span class="token operator">+</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">var</span> subscription2 <span class="token operator">=</span> hot<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>
      x <span class="token operator">=</span><span class="token operator">></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Observer 2: onNext: %s'</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">,</span>
      e <span class="token operator">=</span><span class="token operator">></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Observer 2: onError: %s'</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Observer 2: onCompleted'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// => Current Time after connect: 1431197578426</span>
<span class="token comment" spellcheck="true">// => Observer 1: onNext: 0</span>
<span class="token comment" spellcheck="true">// => Observer 1: onNext: 1</span>
<span class="token comment" spellcheck="true">// => Observer 1: onNext: 2</span>
<span class="token comment" spellcheck="true">// => Current Time after 2nd subscription: 1431197581434</span>
<span class="token comment" spellcheck="true">// => Observer 1: onNext: 3</span>
<span class="token comment" spellcheck="true">// => Observer 2: onNext: 3</span>
<span class="token comment" spellcheck="true">// => Observer 1: onNext: 4</span>
<span class="token comment" spellcheck="true">// => Observer 2: onNext: 4</span>
<span class="token comment" spellcheck="true">// => Observer 1: onNext: 5</span>
<span class="token comment" spellcheck="true">// => Observer 2: onNext: 5</span>
<span class="token comment" spellcheck="true">// => ...</span>
</code></pre>
<p><strong>类推</strong></p>
<p>这有助于思考冷热数据源的关系，就像一个人看（<code>subscribe</code>）电影和表演。</p>
<ul>
<li>冷数据流：电影。</li>
<li>热数据流：现场演出</li>
<li>重播热数据流：录播现场演出</li>
</ul>
<p>你管你何时观看电影，你看电影和别人看都是独立的，尽管所有观看者看的都是相同的内容。另一方面，一个表演是与多个观看都一起分享的。如果你迟到了，你将会错过一部分。不管怎样，如果记录下来了（在 RxJS中可以使用 <code>BehaviorSubject</code> 或 <code>ReplaySubject</code>），你也可像看电影一样看现场演出。<a href="https://github.com/Reactive-Extensions/RxJS/blob/master/doc/api/core/operators/refcount.md" target="_blank" rel="noopener"><code>.publish().refCount()</code></a> 现场表演是艺术家在没有人观看的情况下退出比赛，当观众中至少有一人出现时，他会重新开始演奏。</p>

      
    </div>
    
    
    

    

    

    
      <div>
        <ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>作者：</strong>
    robin.law
  </li>
  
  
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="http://robin-front.github.io/2017/05/04/creating_and_subscribing_to_simple_observable_sequences.html" title="使用RxJS创建和订阅单一数据流">http://robin-front.github.io/2017/05/04/creating_and_subscribing_to_simple_observable_sequences.html</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>
    本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/" rel="external nofollow" target="_blank">CC BY-NC-SA 3.0</a> 许可协议。转载请注明出处！
  </li>
</ul>

      </div>
    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/RxJS/" rel="tag"># RxJS</a>
          
        </div>
      

      
        <h3>相关文章</h3>
        <ul class="popular-posts"><li class="popular-posts-item"><div class="popular-posts-date">2017-06-01</div><div class="popular-posts-title"><h3><a href="/2017/06/01/RXJS-should-i-choose-operator-of-creating.html" title="RXJS我该选用哪个操作符之-创建篇" rel="bookmark">RXJS我该选用哪个操作符之-创建篇</a></h3></div></li><li class="popular-posts-item"><div class="popular-posts-date">2017-06-01</div><div class="popular-posts-title"><h3><a href="/2017/06/01/RXJS-should-i-choose-operator-of-instance.html" title="RXJS我该选用哪个操作符之-实例操作符篇" rel="bookmark">RXJS我该选用哪个操作符之-实例操作符篇</a></h3></div></li><li class="popular-posts-item"><div class="popular-posts-date">2017-05-05</div><div class="popular-posts-title"><h3><a href="/2017/05/05/RxJS-events-binding.html" title="RxJS事件桥接" rel="bookmark">RxJS事件桥接</a></h3></div></li><li class="popular-posts-item"><div class="popular-posts-date">2017-03-19</div><div class="popular-posts-title"><h3><a href="/2017/03/19/animated-intro-rxjs.html" title="RxJS的动画简介" rel="bookmark">RxJS的动画简介</a></h3></div></li><li class="popular-posts-item"><div class="popular-posts-date">2017-06-05</div><div class="popular-posts-title"><h3><a href="/2017/06/05/use-RXJS-compose-filter-and-map-stream.html" title="使用RXJS组合、过滤和映射数据流的值" rel="bookmark">使用RXJS组合、过滤和映射数据流的值</a></h3></div></li></ul>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2017/04/06/check-coverage-of-js-and-css-used-in-Chrome-devtools.html" rel="next" title="Coverage针对js和css的代码覆盖检测-Chrome_devtools的新功能">
                <i class="fa fa-chevron-left"></i> Coverage针对js和css的代码覆盖检测-Chrome_devtools的新功能
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2017/05/05/RxJS-events-binding.html" rel="prev" title="RxJS事件桥接">
                RxJS事件桥接 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  
    <div id="gitalk-container"></div>
  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="https://avatars2.githubusercontent.com/u/6723674?v=3&s=460" alt="robin.law">
            
              <p class="site-author-name" itemprop="name">robin.law</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">96</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">9</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">119</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/robin-front" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:lb.robin1991@gmail.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://twitter.com/lb_robin" target="_blank" title="Twitter">
                      
                        <i class="fa fa-fw fa-twitter"></i>Twitter</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#创建和订阅单一可观察序列"><span class="nav-number">1.</span> <span class="nav-text">创建和订阅单一可观察序列</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#从零创建一个数据流"><span class="nav-number">1.1.</span> <span class="nav-text">从零创建一个数据流</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#创建及订阅单一数据流"><span class="nav-number">1.2.</span> <span class="nav-text">创建及订阅单一数据流</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#使用定时器"><span class="nav-number">1.3.</span> <span class="nav-text">使用定时器</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#将数组和可迭代对象转换为数据流"><span class="nav-number">1.4.</span> <span class="nav-text">将数组和可迭代对象转换为数据流</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#冷（惰性）-vs-热（非惰性）-数据流"><span class="nav-number">1.5.</span> <span class="nav-text">冷（惰性） vs. 热（非惰性） 数据流</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">© 2014 — <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">robin.law</span>

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    
      <span class="post-meta-item-text">Site words total count:</span>
    
    <span title="Site words total count">119.0k</span>
  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 — <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        
<div class="busuanzi-count">
  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
      <i class="fa fa-user"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      
    </span>
  

  
    <span class="site-pv">
      <i class="fa fa-eye"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      
    </span>
  
</div>








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
          <span id="scrollpercent"><span>0</span>%</span>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  




  











  
  
    <script type="text/javascript" src="https://cdn.bootcss.com/jquery/2.1.3/jquery.min.js"></script>
  

  
  
    <script type="text/javascript" src="https://cdn.staticfile.org/fastclick/1.0.6/fastclick.min.js"></script>
  

  
  
    <script type="text/javascript" src="https://cdn.bootcss.com/jquery_lazyload/1.9.7/jquery.lazyload.min.js"></script>
  

  
  
    <script type="text/javascript" src="https://cdn.staticfile.org/velocity/1.2.1/velocity.min.js"></script>
  

  
  
    <script type="text/javascript" src="https://cdn.bootcss.com/velocity/1.2.1/velocity.ui.min.js"></script>
  

  
  
    <script type="text/javascript" src="https://cdn.staticfile.org/fancybox/2.1.5/jquery.fancybox.pack.js"></script>
  

  
  
    <script type="text/javascript" src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  



  
    
      <script type="text/javascript">
        var gitalk = new Gitalk({
          clientID: '470b9e9d99d37489877f',
          clientSecret: 'c319e368fd485f89601b4c2c0cee649bd9cf97cd',
          repo: 'robin-front.github.io',
          owner: 'Robin-front',
          admin: ['Robin-front'],
          id: '使用RxJS创建和订阅单一数据流',
          distractionFreeMode: true,
        });
        gitalk.render('gitalk-container');
      </script>
    

  




	





  





  












  





  

  

  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  
  

  

  

  



<script type="text/javascript" charset="utf-8" src="/js/lazyload-plugin/lazyload.intersectionObserver.min.js"></script></body></html>