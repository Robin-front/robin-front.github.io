<!DOCTYPE html><html class="theme-next muse use-motion" lang="zh-Hans"><head>
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">



  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2" rel="stylesheet">







<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">



  <meta name="google-site-verification" content="ezF4b6TIq3nrF8BJmQrK_v9BmJnUQfVVPB4xBYo7AD8">








  <meta name="baidu-site-verification" content="T2V9h2EnoE">







  
  
    
  
  <link href="https://cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.css" rel="stylesheet" type="text/css">



  
  
    
  
  <link href="https://unpkg.com/gitalk/dist/gitalk.css" rel="stylesheet" type="text/css">







  

<link href="https://cdn.staticfile.org/font-awesome/4.6.2/css/font-awesome.min.css" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/touch-icon.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-16.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-32.png?v=5.1.4">


  <link rel="mask-icon" href="/touch-icon.png?v=5.1.4" color="#222">





  <meta name="keywords" content="lazyload,performance,optimization,IntersectionObserver,">





  <link rel="alternate" href="/atom.xml" title="知更鸟" type="application/atom+xml">






<meta name="description" content="IntersectionObserver假设你想追踪 DOM 里的一个元素是否进入 viewport 的可视区。你做这件事可能是因为你想在这个时机 lazyload 图片或者你需要知道用户是否真的在看一个某个广告横幅。你可以通过添加 scroll 事件钩子或使用定时器去调用元素的 getBoundingClientRect() 方法。然而，这种方法真的很慢，因为每次调用 getBoundingCl">
<meta name="keywords" content="lazyload,performance,optimization,IntersectionObserver">
<meta property="og:type" content="article">
<meta property="og:title" content="IntersectionObserver API">
<meta property="og:url" content="http://robin-front.github.io/2017/08/24/intersectionobserver.html">
<meta property="og:site_name" content="知更鸟">
<meta property="og:description" content="IntersectionObserver假设你想追踪 DOM 里的一个元素是否进入 viewport 的可视区。你做这件事可能是因为你想在这个时机 lazyload 图片或者你需要知道用户是否真的在看一个某个广告横幅。你可以通过添加 scroll 事件钩子或使用定时器去调用元素的 getBoundingClientRect() 方法。然而，这种方法真的很慢，因为每次调用 getBoundingCl">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http://robin-front.github.io/js/lazyload-plugin/loading.svg">
<meta property="og:image" content="http://robin-front.github.io/js/lazyload-plugin/loading.svg">
<meta property="og:image" content="https://developers.google.com/web/updates/images/2016/04/intersectionobserver/infinitescroller.png">
<meta property="og:image" content="http://robin-front.github.io/js/lazyload-plugin/loading.svg">
<meta property="og:updated_time" content="2017-08-24T09:59:34.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="IntersectionObserver API">
<meta name="twitter:description" content="IntersectionObserver假设你想追踪 DOM 里的一个元素是否进入 viewport 的可视区。你做这件事可能是因为你想在这个时机 lazyload 图片或者你需要知道用户是否真的在看一个某个广告横幅。你可以通过添加 scroll 事件钩子或使用定时器去调用元素的 getBoundingClientRect() 方法。然而，这种方法真的很慢，因为每次调用 getBoundingCl">
<meta name="twitter:image" content="http://robin-front.github.io/js/lazyload-plugin/loading.svg">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://robin-front.github.io/2017/08/24/intersectionobserver.html">





  <title>IntersectionObserver API | 知更鸟</title>
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
  (adsbygoogle = window.adsbygoogle || []).push({
    google_ad_client: "ca-pub-8386186071288063",
    enable_page_level_ads: true
  });
  </script>
  




<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-74634898-1', 'auto');
  ga('send', 'pageview');
</script>


  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?51f2c21567935649debac704a10c43f1";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




<link rel="stylesheet" href="/css/prism.css" type="text/css"></head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">知更鸟</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <h1 class="site-subtitle" itemprop="description">robin</h1>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-travel">
          <a href="/tags/travel/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-plane"></i> <br>
            
            旅行
          </a>
        </li>
      
        
        <li class="menu-item menu-item-commonweal">
          <a href="/404/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-heartbeat"></i> <br>
            
            公益404
          </a>
        </li>
      
        
        <li class="menu-item menu-item-sitemap">
          <a href="/sitemap.xml" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-sitemap"></i> <br>
            
            站点地图
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://robin-front.github.io/2017/08/24/intersectionobserver.html">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="robin.law">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars2.githubusercontent.com/u/6723674?v=3&s=460">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="知更鸟">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">IntersectionObserver API</h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-08-24T09:59:34+00:00">
                2017-08-24
              </time>
            

            
              <span class="post-meta-divider">|</span>
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-check-o"></i>
              </span>
              
                <span class="post-meta-item-text">更新于:</span>
              
              <time title="更新于" itemprop="dateModified" datetime="2017-08-24T09:59:34+00:00">
                2017-08-24
              </time>
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/javascript/" itemprop="url" rel="index">
                    <span itemprop="name">javascript</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          
            <span class="post-meta-divider">|</span>
            <span class="page-pv"><i class="fa fa-file-o"></i>
            <span class="busuanzi-value" id="busuanzi_value_page_pv"></span>
            </span>
          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计:</span>
                
                <span title="字数统计">
                  1,554
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 ≈</span>
                
                <span title="阅读时长">
                  6
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="IntersectionObserver"><a href="#IntersectionObserver" class="headerlink" title="IntersectionObserver"></a>IntersectionObserver</h1><p>假设你想追踪 DOM 里的一个元素是否进入 <a href="https://en.wikipedia.org/wiki/Viewport" target="_blank" rel="noopener">viewport</a> 的可视区。你做这件事可能是因为你想在这个时机 lazyload 图片或者你需要知道用户是否真的在看一个某个广告横幅。你可以通过添加 <code>scroll</code> 事件钩子或使用定时器去调用元素的 <code>getBoundingClientRect()</code> 方法。然而，这种方法真的很慢，因为每次调用 <code>getBoundingClientRect()</code> <a href="https://gist.github.com/paulirish/5d52fb081b3570c81e3a" target="_blank" rel="noopener">会造成浏览器 re-layout 当前页面</a> 并会在你的页面造成很大的卡顿和闪烁。 <code>iframe</code> 里的元素是否可见这样的事情几乎很难做到。 基于单一源模型，浏览器不会让你访问包含 <code>iframe</code> 的页面的任何数据。这是频繁使用 <code>iframe</code> 加载广告的常见问题。</p>
<p>为了让可见度测试更有效率， <a href="https://wicg.github.io/IntersectionObserver/" target="_blank" rel="noopener">IntersectionObserver</a> 被设计出来了。<code>IntersectionObserver</code> 让你知道观察的元素何时进入或退出浏览器 <code>viewport</code>。
<a id="more"></a></p>
<p></p><div class="progress-images" style="width:320px"><div class="progress-images--placeholder" style="padding-bottom: 202.8125%;"></div><img src="/js/lazyload-plugin/loading.svg" alt="https://developers.google.com/web/updates/images/2016/04/intersectionobserver/iframe.gif" class="progress-images--original" data-original="https://developers.google.com/web/updates/images/2016/04/intersectionobserver/iframe.gif" data-thumb="/images/thumb/6551e1db99f0503ca8d04871ccf802d8.gif"></div><p></p>
<h2 id="如何创建一个-IntersectionObserver"><a href="#如何创建一个-IntersectionObserver" class="headerlink" title="如何创建一个 IntersectionObserver"></a>如何创建一个 IntersectionObserver</h2><p>API 相当简单，例子一看就懂：</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> io <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IntersectionObserver</span><span class="token punctuation">(</span>
    entries <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>entries<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">/* 使用默认选项，详细在下面会介绍 */</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">// 开始观察一个元素</span>
io<span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// 停止观察一个元素</span>
<span class="token comment" spellcheck="true">// io.unobserve(element);</span>

<span class="token comment" spellcheck="true">// 禁用整个 IntersectionObserver</span>
<span class="token comment" spellcheck="true">// io.disconnect();</span>
</code></pre>
<p>使用默认选项，回调会在元素进入和完全退出 <code>viewport</code> 的时候触发。</p>
<p>如果你需要观察多个元素，建议在同一个 <code>IntersectionObserver</code> 实例上多次调用 <code>observe()</code> 来观察多个元素，这也是允许的调用方式。</p>
<p>回调函数回传的参数是一个数组对象 <a href="https://wicg.github.io/IntersectionObserver/#intersection-observer-entry" target="_blank" rel="noopener"><code>IntersectionObserverEntry</code></a> 。每个这样的对象都包含了每个观察元素的最新数据。</p>
<pre class=" language-ruby"><code class="language-ruby">🔽<span class="token punctuation">[</span><span class="token constant">IntersectionObserverEntry</span><span class="token punctuation">]</span>
  🔽 <span class="token number">0</span><span class="token punctuation">:</span> <span class="token constant">IntersectionObserverEntry</span>
       time<span class="token punctuation">:</span> <span class="token number">3893.92</span>
    🔽 rootBounds<span class="token punctuation">:</span> <span class="token constant">ClientRect</span>
        bottom<span class="token punctuation">:</span> <span class="token number">920</span>
        height<span class="token punctuation">:</span> <span class="token number">1024</span>
        left<span class="token punctuation">:</span> <span class="token number">0</span>
        right<span class="token punctuation">:</span> <span class="token number">1024</span>
        top<span class="token punctuation">:</span> <span class="token number">0</span>
        width<span class="token punctuation">:</span> <span class="token number">920</span>
    🔽 boundingClientRect<span class="token punctuation">:</span> <span class="token constant">ClientRect</span>
       <span class="token operator">/</span><span class="token operator">/</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    🔽 intersectionRect<span class="token punctuation">:</span> <span class="token constant">ClientRect</span>
       <span class="token operator">/</span><span class="token operator">/</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
      intersectionRatio<span class="token punctuation">:</span> <span class="token number">0.54</span>
    🔽 target<span class="token punctuation">:</span> div<span class="token comment" spellcheck="true">#observee</span>
       <span class="token operator">/</span><span class="token operator">/</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</code></pre>
<ul>
<li><a href="https://wicg.github.io/IntersectionObserver/#dom-intersectionobserverentry-rootbounds" target="_blank" rel="noopener"><code>rootBounds</code></a> 是对 root 元素调用 <code>getBoundingClientRect</code> 的结果，默认 root 元素是 viewport 。</li>
<li><a href="https://wicg.github.io/IntersectionObserver/#dom-intersectionobserverentry-boundingclientrect" target="_blank" rel="noopener"><code>boundingClientRect</code></a> 是被观察元素调用 <code>getBoundingClientRect</code> 的结果。</li>
<li><a href="https://wicg.github.io/IntersectionObserver/#dom-intersectionobserverentry-intersectionrect" target="_blank" rel="noopener"><code>intersectionRect</code></a> 是两个矩形的交叉部分，可能有效地告诉你被观察的元素的哪一部分是可见的。</li>
<li><a href="https://wicg.github.io/IntersectionObserver/#dom-intersectionobserverentry-intersectionratio" target="_blank" rel="noopener"><code>intersectionRatio</code></a> 是最相关的，告诉你元素有百分之几是可见的。</li>
</ul>
<p>有了这些信息，你现在可以实现元素进入 viewport 前及时加载的特性。非常有用。</p>
<p></p><div class="progress-images" style="width:886px"><div class="progress-images--placeholder" style="padding-bottom: 98.87133182844244%;"></div><img src="/js/lazyload-plugin/loading.svg" alt="https://developers.google.com/web/updates/images/2016/04/intersectionobserver/intersectratio.png" class="progress-images--original" data-original="https://developers.google.com/web/updates/images/2016/04/intersectionobserver/intersectratio.png" data-thumb="/images/thumb/fb2b57edb4e60431c87acec39acc29fc.png"></div><p></p>
<p><code>IntersectionObservers</code> 是异步推送他们的数据，而回调是运行在主线程的。另外，规范提到 <code>IntersectionObserver</code> 应该使用 <a href="https://wicg.github.io/IntersectionObserver/#queue-intersection-observer-task" target="_blank" rel="noopener"><code>requestIdleCallback()</code></a>。 这意味着调用回调函数的优先级是非常低的，只会在浏览器有空闲的时候调用。这是有意设计的。</p>
<h2 id="Scrolling-divs"><a href="#Scrolling-divs" class="headerlink" title="Scrolling divs"></a>Scrolling divs</h2><p>我并不喜欢在 div 中滚动元素, 但我不会用 <code>scroll</code> 判定, 而是用 <code>IntersectionObserver</code>。 <a href="https://wicg.github.io/IntersectionObserver/#dictdef-intersectionobserverinit" target="_blank" rel="noopener"><code>option</code></a> 对象有一个 <a href="https://wicg.github.io/IntersectionObserver/#dom-intersectionobserverinit-root" target="_blank" rel="noopener"><code>root</code></a> 选项让你定义一个代替 viewport 的 root 元素。需要记住的是，要保证 root 元素是所有被观察元素的祖先。</p>
<h2 id="重叠所有元素"><a href="#重叠所有元素" class="headerlink" title="重叠所有元素"></a>重叠所有元素</h2><p>不！那是糟糕的开发者！请注意使用用户的 CPU 周期。让我们考虑一下无限滚动的例子： 在脚本中，添加一个哨兵来观察和回收是明智的选择。你应该在无限滚动的最后一个元素添加哨兵。当哨兵快要进入 viewport 的时候，在回调函数中加载数据，创建接下来的元素，并添加到哨兵之前的 DOM 结构中。如果重复利用哨兵，不需要再调用 <code>observe()</code>， <code>IntersectionObserver</code> 仍然会继续工作。</p>
<p><img src="https://developers.google.com/web/updates/images/2016/04/intersectionobserver/infinitescroller.png" alt="https://developers.google.com/web/updates/images/2016/04/intersectionobserver/infinitescroller.png"></p>
<h3 id="更多地更新与回调调用"><a href="#更多地更新与回调调用" class="headerlink" title="更多地更新与回调调用"></a>更多地更新与回调调用</h3><p>就像前面提到的，当被监听元素进入或离开 viewport 的时候，回调函数会分别单次触发。 这让<code>IntersectionObserver</code> 可以给你这个问题的答案，“元素 X 是否在视图中？”。但在某些场景中，这还不够。</p>
<p><a href="https://wicg.github.io/IntersectionObserver/#dom-intersectionobserverinit-threshold" target="_blank" rel="noopener"><code>theshold</code></a> 选项登场。它允许你定义一个 <a href="https://wicg.github.io/IntersectionObserver/#dom-intersectionobserverentry-intersectionratio" target="_blank" rel="noopener"><code>intersectionRatio</code></a> 阈值数组。当达到每一个 <code>intersectionRatio</code> 值时，回调函数都会被调用。<code>theshold</code> 默认值是 <code>[0]</code>，就是我们解释的默认表现。当设定 <code>theshold</code> 为 <code>[0, 0.25, 0.5, 0.75, 1]</code>, 我们会在元素每四分之一的部分进入 viewport 时得到通知。</p>
<p></p><div class="progress-images" style="width:320px"><div class="progress-images--placeholder" style="padding-bottom: 202.8125%;"></div><img src="/js/lazyload-plugin/loading.svg" alt="https://developers.google.com/web/updates/images/2016/04/intersectionobserver/threshold.gif" class="progress-images--original" data-original="https://developers.google.com/web/updates/images/2016/04/intersectionobserver/threshold.gif" data-thumb="/images/thumb/e487b37fcc28012db95042b162af5a72.gif"></div><p></p>
<h3 id="还有其他问题吗？"><a href="#还有其他问题吗？" class="headerlink" title="还有其他问题吗？"></a>还有其他问题吗？</h3><p>到现在为止，还有一个选项没有被提到。<a href="https://wicg.github.io/IntersectionObserver/#dom-intersectionobserverinit-rootmargin" target="_blank" rel="noopener"><code>rootMargin</code></a> 允许你指定 <code>root</code> 元素的 <code>margin</code>，有效地允许你增加或缩减实际的交叉区域。<code>margin</code> 使用 css-style 的规则， <code>10px 20px 30px 40px</code> 分别表示上、右、下、左。总的来说，<code>IntersectionObserver</code> 的选项总结如下：</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">new</span> <span class="token class-name">IntersectionObserver</span><span class="token punctuation">(</span>entries <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span><span class="token comment" spellcheck="true">/* … */</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token comment" spellcheck="true">// The root to use for intersection.</span>
  <span class="token comment" spellcheck="true">// If not provided, use the top-level document’s viewport.</span>
  root<span class="token punctuation">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
  <span class="token comment" spellcheck="true">// Same as margin, can be 1, 2, 3 or 4 components, possibly negative lengths.  </span>
  <span class="token comment" spellcheck="true">// If an explicit root element is specified, components may be percentages of the</span>
  <span class="token comment" spellcheck="true">// root element size.  If no explicit root element is specified, using a percentage</span>
  <span class="token comment" spellcheck="true">// is an error.</span>
  rootMargin<span class="token punctuation">:</span> <span class="token string">"0px"</span><span class="token punctuation">,</span>
  <span class="token comment" spellcheck="true">// Threshold(s) at which to trigger callback, specified as a ratio, or list of</span>
  <span class="token comment" spellcheck="true">// ratios, of (visible area / total area) of the observed element (hence all</span>
  <span class="token comment" spellcheck="true">// entries must be in the range [0, 1]).  Callback will be invoked when the visible</span>
  <span class="token comment" spellcheck="true">// ratio of the observed element crosses a threshold in the list.</span>
  threshold<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h3 id="iframe-魔法"><a href="#iframe-魔法" class="headerlink" title="iframe 魔法"></a>iframe 魔法</h3><p><code>IntersectionObserver</code> 被设计时明确考虑广告服务和网络社交服务，可能经常会用到 <code>iframe</code> 和有益于知道他们是否在看。如果观察 <code>iframe</code> 中的元素，那么滚动 <code>iframe</code> 和滚动父页面都可以在适当的时候触发回调函数。对于后者， <code>rootBounds</code> 将被设置为 <code>null</code> 以避免数据源泄漏。</p>
<h2 id="IntersectionObserver-不是什么？"><a href="#IntersectionObserver-不是什么？" class="headerlink" title="IntersectionObserver 不是什么？"></a><code>IntersectionObserver</code> 不是什么？</h2><p>需要知道的是， <code>IntersectionObserver</code> 是被故意设置成不完美和低延迟的。使用它们努力实现像滚动动画之类是注定会失败的。因为严格地说，当你获得数据时，数据已经过时了。这里有更多的关于 <code>IntersectionObserver</code> <a href="https://github.com/WICG/IntersectionObserver/blob/gh-pages/explainer.md" target="_blank" rel="noopener">原始用例</a>。</p>
<h2 id="可以在-callback-中做多少事情"><a href="#可以在-callback-中做多少事情" class="headerlink" title="可以在 callback 中做多少事情"></a>可以在 <code>callback</code> 中做多少事情</h2><p>在回调中花太多时候会让你的应用滞后，和常见的实践一样。</p>
<h2 id="使用-IntersectionObserver"><a href="#使用-IntersectionObserver" class="headerlink" title="使用 IntersectionObserver"></a>使用 IntersectionObserver</h2><p>对于 <code>IntersectionObserver</code>，浏览器的支持仍然很弱，所以它不会马上被普遍应用。同时，<a href="https://github.com/WICG/IntersectionObserver" target="_blank" rel="noopener">WICG</a> 的 polyfill 也被建立起来。显然，使用 polyfill 不如原生实现的效率好。</p>
<blockquote>
<p>Except as otherwise noted, the content of this page is licensed under the Creative Commons Attribution 3.0 License, and code samples are licensed under the Apache 2.0 License. For details, see our Site Policies. Java is a registered trademark of Oracle and/or its affiliates.
上次更新日期：六月 5, 2017</p>
</blockquote>
<p>【翻译原文】： <a href="https://developers.google.com/web/updates/2016/04/intersectionobserver" target="_blank" rel="noopener">intersectionobserver</a></p>

      
    </div>
    
    
    

    

    

    
      <div>
        <ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>作者：</strong>
    robin.law
  </li>
  
  
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="http://robin-front.github.io/2017/08/24/intersectionobserver.html" title="IntersectionObserver API">http://robin-front.github.io/2017/08/24/intersectionobserver.html</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>
    本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/" rel="external nofollow" target="_blank">CC BY-NC-SA 3.0</a> 许可协议。转载请注明出处！
  </li>
</ul>

      </div>
    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/lazyload/" rel="tag"># lazyload</a>
          
            <a href="/tags/performance/" rel="tag"># performance</a>
          
            <a href="/tags/optimization/" rel="tag"># optimization</a>
          
            <a href="/tags/IntersectionObserver/" rel="tag"># IntersectionObserver</a>
          
        </div>
      

      
        <h3>相关文章</h3>
        <ul class="popular-posts"><li class="popular-posts-item"><div class="popular-posts-date">2017-08-18</div><div class="popular-posts-title"><h3><a href="/2017/08/18/lazy-loading-images-using-intersection-observer.html" title="使用 intersection observer 延迟加载图片" rel="bookmark">使用 intersection observer 延迟加载图片</a></h3></div></li><li class="popular-posts-item"><div class="popular-posts-date">2017-08-25</div><div class="popular-posts-title"><h3><a href="/2017/08/25/using-requestIdleCallback.html" title="使用 requestIdleCallback" rel="bookmark">使用 requestIdleCallback</a></h3></div></li><li class="popular-posts-item"><div class="popular-posts-date">2017-07-11</div><div class="popular-posts-title"><h3><a href="/2017/07/11/why-should-stopped-using-multiple-monitors.html" title="为什么我停止使用多个显示器" rel="bookmark">为什么我停止使用多个显示器</a></h3></div></li></ul>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2017/08/18/lazy-loading-images-using-intersection-observer.html" rel="next" title="使用 intersection observer 延迟加载图片">
                <i class="fa fa-chevron-left"></i> 使用 intersection observer 延迟加载图片
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2017/08/25/using-requestIdleCallback.html" rel="prev" title="使用 requestIdleCallback">
                使用 requestIdleCallback <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  
    <div id="gitalk-container"></div>
  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="https://avatars2.githubusercontent.com/u/6723674?v=3&s=460" alt="robin.law">
            
              <p class="site-author-name" itemprop="name">robin.law</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">96</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">9</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">119</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/robin-front" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:lb.robin1991@gmail.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://twitter.com/lb_robin" target="_blank" title="Twitter">
                      
                        <i class="fa fa-fw fa-twitter"></i>Twitter</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#IntersectionObserver"><span class="nav-number">1.</span> <span class="nav-text">IntersectionObserver</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#如何创建一个-IntersectionObserver"><span class="nav-number">1.1.</span> <span class="nav-text">如何创建一个 IntersectionObserver</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Scrolling-divs"><span class="nav-number">1.2.</span> <span class="nav-text">Scrolling divs</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#重叠所有元素"><span class="nav-number">1.3.</span> <span class="nav-text">重叠所有元素</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#更多地更新与回调调用"><span class="nav-number">1.3.1.</span> <span class="nav-text">更多地更新与回调调用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#还有其他问题吗？"><span class="nav-number">1.3.2.</span> <span class="nav-text">还有其他问题吗？</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#iframe-魔法"><span class="nav-number">1.3.3.</span> <span class="nav-text">iframe 魔法</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#IntersectionObserver-不是什么？"><span class="nav-number">1.4.</span> <span class="nav-text">IntersectionObserver 不是什么？</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#可以在-callback-中做多少事情"><span class="nav-number">1.5.</span> <span class="nav-text">可以在 callback 中做多少事情</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#使用-IntersectionObserver"><span class="nav-number">1.6.</span> <span class="nav-text">使用 IntersectionObserver</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">© 2014 — <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">robin.law</span>

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    
      <span class="post-meta-item-text">Site words total count:</span>
    
    <span title="Site words total count">119.0k</span>
  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 — <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        
<div class="busuanzi-count">
  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
      <i class="fa fa-user"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      
    </span>
  

  
    <span class="site-pv">
      <i class="fa fa-eye"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      
    </span>
  
</div>








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
          <span id="scrollpercent"><span>0</span>%</span>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  




  











  
  
    <script type="text/javascript" src="https://cdn.bootcss.com/jquery/2.1.3/jquery.min.js"></script>
  

  
  
    <script type="text/javascript" src="https://cdn.staticfile.org/fastclick/1.0.6/fastclick.min.js"></script>
  

  
  
    <script type="text/javascript" src="https://cdn.bootcss.com/jquery_lazyload/1.9.7/jquery.lazyload.min.js"></script>
  

  
  
    <script type="text/javascript" src="https://cdn.staticfile.org/velocity/1.2.1/velocity.min.js"></script>
  

  
  
    <script type="text/javascript" src="https://cdn.bootcss.com/velocity/1.2.1/velocity.ui.min.js"></script>
  

  
  
    <script type="text/javascript" src="https://cdn.staticfile.org/fancybox/2.1.5/jquery.fancybox.pack.js"></script>
  

  
  
    <script type="text/javascript" src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  



  
    
      <script type="text/javascript">
        var gitalk = new Gitalk({
          clientID: '470b9e9d99d37489877f',
          clientSecret: 'c319e368fd485f89601b4c2c0cee649bd9cf97cd',
          repo: 'robin-front.github.io',
          owner: 'Robin-front',
          admin: ['Robin-front'],
          id: 'IntersectionObserver API',
          distractionFreeMode: true,
        });
        gitalk.render('gitalk-container');
      </script>
    

  




	





  





  












  





  

  

  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  
  

  

  

  



<script type="text/javascript" charset="utf-8" src="/js/lazyload-plugin/lazyload.intersectionObserver.min.js"></script></body></html>