NexT.utils=NexT.$u={wrapImageWithFancyBox:function(){$(".content img").not("[hidden]").not(".group-picture img, .post-gallery img").each(function(){var i=$(this);var e=i.attr("title");var t=i.parent("a");if(t.size()<1){t=i.wrap('<a href="'+this.getAttribute("src")+'"></a>').parent("a")}t.addClass("fancybox fancybox.image");t.attr("rel","group");if(e){t.append('<p class="image-caption">'+e+"</p>");t.attr("title",e)}});$(".fancybox").fancybox({helpers:{overlay:{locked:false}}})},lazyLoadPostsImages:function(){$("#posts").find("img").lazyload({placeholder:"/images/loading.gif",effect:"fadeIn"})},registerESCKeyEvent:function(){$(document).on("keyup",function(i){var e=i.which===27&&$(".search-popup").is(":visible");if(e){$(".search-popup").hide();$(".search-popup-overlay").remove();$("body").css("overflow","")}})},registerBackToTop:function(){var i=50;var e=$(".back-to-top");$(window).on("scroll",function(){e.toggleClass("back-to-top-on",window.pageYOffset>i);var t=$(window).scrollTop();var o=$(document).height();var n=$(window).height();var s=t/(o-n);var r=Math.round(s*100);$("#scrollpercent>span").html(r)});e.on("click",function(){$("body").velocity("scroll")})},embeddedVideoTransformer:function(){var i=$("iframe");var e=["www.youtube.com","player.vimeo.com","player.youku.com","music.163.com","www.tudou.com"];var t=new RegExp(e.join("|"));i.each(function(){var i=this;var e=$(this);var s=o(e);var r;if(this.src.search(t)>0){var a=n(s.width,s.height);e.width("100%").height("100%").css({position:"absolute",top:"0",left:"0"});var l=document.createElement("div");l.className="fluid-vids";l.style.position="relative";l.style.marginBottom="20px";l.style.width="100%";l.style.paddingTop=a+"%";var d=i.parentNode;d.insertBefore(l,i);l.appendChild(i);if(this.src.search("music.163.com")>0){r=o(e);var c=r.width>s.width||r.height<s.height;if(c){l.style.paddingTop=n(r.width,s.height)+"%"}}}});function o(i){return{width:i.width(),height:i.height()}}function n(i,e){return e/i*100}},addActiveClassToMenuItem:function(){var i=window.location.pathname;i=i==="/"?i:i.substring(0,i.length-1);$('.menu-item a[href="'+i+'"]').parent().addClass("menu-item-active")},hasMobileUA:function(){var i=window.navigator;var e=i.userAgent;var t=/iPad|iPhone|Android|Opera Mini|BlackBerry|webOS|UCWEB|Blazer|PSP|IEMobile|Symbian/g;return t.test(e)},isTablet:function(){return window.screen.width<992&&window.screen.width>767&&this.hasMobileUA()},isMobile:function(){return window.screen.width<767&&this.hasMobileUA()},isDesktop:function(){return!this.isTablet()&&!this.isMobile()},escapeSelector:function(i){return i.replace(/[!"$%&'()*+,.\/:;<=>?@[\\\]^`{|}~]/g,"\\$&")},displaySidebar:function(){if(!this.isDesktop()||this.isPisces()){return}$(".sidebar-toggle").trigger("click")},isMist:function(){return CONFIG.scheme==="Mist"},isPisces:function(){return CONFIG.scheme==="Pisces"},getScrollbarWidth:function(){var i=$("<div />").addClass("scrollbar-measure").prependTo("body");var e=i[0];var t=e.offsetWidth-e.clientWidth;i.remove();return t},needAffix:function(){return this.isPisces()}};$(document).ready(function(){NexT.motion={};var i={lines:[],push:function(i){this.lines.push(i)},init:function(){this.lines.forEach(function(i){i.init()})},arrow:function(){this.lines.forEach(function(i){i.arrow()})},close:function(){this.lines.forEach(function(i){i.close()})}};function e(i){this.el=$(i.el);this.status=$.extend({},{init:{width:"100%",opacity:1,left:0,rotateZ:0,top:0}},i.status)}e.prototype.init=function(){this.transform("init")};e.prototype.arrow=function(){this.transform("arrow")};e.prototype.close=function(){this.transform("close")};e.prototype.transform=function(i){this.el.velocity("stop").velocity(this.status[i])};var t=new e({el:".sidebar-toggle-line-first",status:{arrow:{width:"50%",rotateZ:"-45deg",top:"2px"},close:{width:"100%",rotateZ:"-45deg",top:"5px"}}});var o=new e({el:".sidebar-toggle-line-middle",status:{arrow:{width:"90%"},close:{opacity:0}}});var n=new e({el:".sidebar-toggle-line-last",status:{arrow:{width:"50%",rotateZ:"45deg",top:"-2px"},close:{width:"100%",rotateZ:"45deg",top:"-5px"}}});i.push(t);i.push(o);i.push(n);var s="320px";var r=0;var a={toggleEl:$(".sidebar-toggle"),sidebarEl:$(".sidebar"),isSidebarVisible:false,init:function(){this.toggleEl.on("click",this.clickHandler.bind(this));this.toggleEl.on("mouseenter",this.mouseEnterHandler.bind(this));this.toggleEl.on("mouseleave",this.mouseLeaveHandler.bind(this));$(document).on("sidebar.isShowing",function(){NexT.utils.isDesktop()&&$("body").velocity("stop").velocity({paddingRight:s},r)}).on("sidebar.isHiding",function(){})},clickHandler:function(){this.isSidebarVisible?this.hideSidebar():this.showSidebar();this.isSidebarVisible=!this.isSidebarVisible},mouseEnterHandler:function(){if(this.isSidebarVisible){return}i.arrow()},mouseLeaveHandler:function(){if(this.isSidebarVisible){return}i.init()},showSidebar:function(){var e=this;i.close();this.sidebarEl.velocity("stop").velocity({width:s},{display:"block",duration:r,begin:function(){$(".sidebar .motion-element").velocity("transition.slideRightIn",{stagger:50,drag:true,complete:function(){e.sidebarEl.trigger("sidebar.motion.complete")}})},complete:function(){e.sidebarEl.addClass("sidebar-active");e.sidebarEl.trigger("sidebar.didShow")}});this.sidebarEl.trigger("sidebar.isShowing")},hideSidebar:function(){NexT.utils.isDesktop()&&$("body").velocity("stop").velocity({paddingRight:0});this.sidebarEl.find(".motion-element").velocity("stop").css("display","none");this.sidebarEl.velocity("stop").velocity({width:0},{display:"none"});i.init();this.sidebarEl.removeClass("sidebar-active");this.sidebarEl.trigger("sidebar.isHiding");if(!!$(".post-toc-wrap")){if($(".site-overview").css("display")==="block"){$(".post-toc-wrap").removeClass("motion-element")}}}};a.init();NexT.motion.integrator={queue:[],cursor:-1,add:function(i){this.queue.push(i);return this},next:function(){this.cursor++;var i=this.queue[this.cursor];$.isFunction(i)&&i(NexT.motion.integrator)},bootstrap:function(){this.next()}};NexT.motion.middleWares={logo:function(i){var e=[];var t=$(".brand");var o=$(".site-title");var n=$(".site-subtitle");var s=$(".logo-line-before i");var r=$(".logo-line-after i");t.size()>0&&e.push({e:t,p:{opacity:1},o:{duration:200}});NexT.utils.isMist()&&l([s,r])&&e.push(a(s,"100%"),a(r,"-100%"));l(o)&&e.push({e:o,p:{opacity:1,top:0},o:{duration:200}});l(n)&&e.push({e:n,p:{opacity:1,top:0},o:{duration:200}});if(e.length>0){e[e.length-1].o.complete=function(){i.next()};$.Velocity.RunSequence(e)}else{i.next()}function a(i,e){return{e:$(i),p:{translateX:e},o:{duration:500,sequenceQueue:false}}}function l(i){i=Array.isArray(i)?i:[i];return i.every(function(i){return $.isFunction(i.size)&&i.size()>0})}},menu:function(i){$(".menu-item").velocity("transition.slideDownIn",{display:null,duration:200,complete:function(){i.next()}})},postList:function(i){var e=$(".post");var t=e.size()>0;t?o():i.next();function o(){var t=window.postMotionOptions||{stagger:100,drag:true};t.complete=function(){i.next()};e.velocity("transition.slideDownIn",t)}},sidebar:function(i){if(CONFIG.sidebar.display==="always"){NexT.utils.displaySidebar()}i.next()}}});$(document).ready(function(){$(document).trigger("bootstrap:before");NexT.utils.isMobile()&&window.FastClick.attach(document.body);NexT.utils.lazyLoadPostsImages();NexT.utils.registerESCKeyEvent();NexT.utils.registerBackToTop();$(".site-nav-toggle button").on("click",function(){var i=$(".site-nav");var e="site-nav-on";var t=i.hasClass(e);var o=t?"slideUp":"slideDown";var n=t?"removeClass":"addClass";i.stop()[o]("fast",function(){i[n](e)})});CONFIG.fancybox&&NexT.utils.wrapImageWithFancyBox();NexT.utils.embeddedVideoTransformer();NexT.utils.addActiveClassToMenuItem();NexT.motion.integrator.add(NexT.motion.middleWares.logo).add(NexT.motion.middleWares.menu).add(NexT.motion.middleWares.postList).add(NexT.motion.middleWares.sidebar);$(document).trigger("motion:before");CONFIG.motion&&NexT.motion.integrator.bootstrap();$(document).trigger("bootstrap:after")});